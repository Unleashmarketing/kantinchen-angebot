<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Laras Kantinchen | Mindestabnahme</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap');

        :root {
            --primary-color: #5d4037;
            --accent-orange: #e67e22;
        }

        body { font-family: 'Open Sans', sans-serif; background: #95a5a6; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* --- EDITOR SIDEBAR --- */
        .editor-panel { width: 420px; background: white; padding: 20px; box-shadow: 2px 0 15px rgba(0,0,0,0.2); overflow-y: auto; z-index: 10; }
        h2 { color: var(--primary-color); font-size: 16px; border-bottom: 2px solid var(--primary-color); padding-bottom: 5px; margin-top: 20px; text-transform: uppercase; }
        
        .section-box { background: #fdfaf9; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 15px; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 11px; font-weight: bold; color: #555; margin-bottom: 4px; text-transform: uppercase; }
        .form-group input, .form-group textarea { 
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-family: inherit; font-size: 13px;
        }

        .btn-print { background: #27ae60; padding: 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%; color: white; margin-top: 30px; font-size: 16px; }

        /* --- A4 PREVIEW --- */
        .preview-panel { flex-grow: 1; padding: 40px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; gap: 40px; }
        .a4-page { 
            width: 210mm; height: 297mm; min-height: 297mm; background: white; padding: 20mm; 
            box-shadow: 0 0 20px rgba(0,0,0,0.4); box-sizing: border-box; position: relative; 
            display: flex; flex-direction: column; page-break-after: always;
        }

        .header-logo { position: absolute; top: 15mm; right: 20mm; width: 40mm; }
        .sender-line { font-size: 7.5pt; color: #777; text-decoration: underline; margin-bottom: 8mm; }
        .address-box { font-size: 11pt; margin-bottom: 15mm; line-height: 1.4; min-height: 30mm; }
        .event-info { font-size: 10pt; margin-bottom: 5mm; border-collapse: collapse; }
        .event-info td { padding: 3px 0; }
        .event-info td:first-child { font-weight: bold; width: 35mm; }
        
        .reserviert-banner { color: var(--accent-orange); font-weight: bold; font-style: italic; text-align: center; font-size: 14pt; margin: 10mm 0; }
        .intro-text { font-size: 11pt; line-height: 1.6; white-space: pre-wrap; margin-bottom: 10mm; }

        .offer-header-small { font-size: 9pt; color: #555; margin-bottom: 5mm; }
        
        /* TABELLE OPTIMIERUNG */
        .mindest-table { width: 100%; border-collapse: collapse; margin-bottom: 10mm; font-size: 8.5pt; table-layout: fixed; }
        .mindest-table th, .mindest-table td { border: 1px solid #000; padding: 8px; vertical-align: top; overflow-wrap: break-word; }
        
        /* Spaltenbreiten */
        .col-pos { width: 55%; } 
        .col-qty { width: 12%; }
        .col-money { width: 16.5%; }

        .mindest-table th { color: var(--accent-orange); font-weight: 700; font-size: 11pt; text-align: center; }
        .product-title { font-weight: bold; color: var(--primary-color); }
        .product-desc { font-size: 8.5pt; color: #333; margin-top: 2px; }
        .vegan { color: #2e7d32; font-weight: bold; }

        /* Footer */
        .document-footer {
            position: absolute; bottom: 10mm; left: 20mm; right: 20mm;
            display: grid; grid-template-columns: repeat(4, 1fr);
            font-size: 7pt; color: #333; border-top: 0.5px solid #ccc; padding-top: 5px;
        }
        .footer-col { line-height: 1.4; }

        @media print {
            .editor-panel, .no-print { display: none !important; }
            .preview-panel { padding: 0; background: white; overflow: visible; }
            .a4-page { box-shadow: none; margin: 0; width: 210mm; height: 297mm; }
            body { background: white; }
        }
    </style>
</head>
<body>

<div class="editor-panel">
    <h2>1. Anschreiben</h2>
    <div class="section-box">
        <div class="form-group">
            <label>Einleitungstext</label>
            <textarea id="inp-intro" rows="6" oninput="render()">Sehr geehrte Damen und Herren,

vielen Dank für Ihre Anfrage. 
Anbei übersenden wir Ihnen die ausgearbeiteten Vorschläge für Ihr Event auf Basis einer Mindestabnahme.

Wir freuen uns auf Ihre Rückmeldung!</textarea>
        </div>
    </div>

    <h2>2. Preise & Gebühren</h2>
    <div class="section-box">
        <div class="form-group">
            <label>Mindestabnahme Menge</label>
            <input type="number" id="inp-qty" value="100" oninput="render()">
        </div>
        <div class="form-group">
            <label>Preis pro Portion (€ Brutto)</label>
            <input type="number" id="inp-price" value="10.00" step="0.01" oninput="render()">
        </div>
        <div class="form-group">
            <label>Service Grundpreis (€ Brutto)</label>
            <input type="number" id="inp-service-base" value="450.00" step="0.01" oninput="render()">
        </div>
        <div class="form-group">
            <label>Zusatzstunde/Pers. (€ Brutto)</label>
            <input type="number" id="inp-service-extra" value="35.00" step="0.01" oninput="render()">
        </div>
    </div>

    <button class="btn btn-print" onclick="window.print()">ANGEBOT DRUCKEN (PDF)</button>
</div>

<div class="preview-panel">
    <div class="a4-page">
        <img src="https://via.placeholder.com/200x120?text=LARAS+LOGO" class="header-logo">
        <div class="sender-line">Laras Kantinchen, Chr.-Kröwerath-Straße 132, 67071 Ludwigshafen</div>
        <div class="address-box" id="out-recipient"></div>
        <div style="text-align: right; font-size: 10.5pt; margin-bottom: 5mm;" id="out-today"></div>
        
        <table class="event-info">
            <tr><td>Catering:</td><td id="out-date"></td></tr>
            <tr><td>Event:</td><td id="out-event"></td></tr>
            <tr><td>Ort / Location:</td><td id="out-location"></td></tr>
            <tr><td>Uhrzeit:</td><td id="out-time"></td></tr>
            <tr><td>Angebot Nr.:</td><td id="out-offer-id"></td></tr>
        </table>
        
        <div class="reserviert-banner">Reserviert bis zum <span id="out-valid-until"></span></div>
        <div class="intro-text" id="out-intro"></div>

        <div class="document-footer">
            <div class="footer-col"><strong>Laras Kantinchen</strong><br>Chr.-Kröwerath-Str. 132<br>67071 Ludwigshafen</div>
            <div class="footer-col">Fon: 01 72 - 6 67 67 87<br>Fax: 06 21 - 65 05 57 96<br>laras-kantinchen@email.de</div>
            <div class="footer-col">Sparkasse Rhein-Haardt<br>IBAN: DE31 5465 1240 0006 1170 63</div>
            <div class="footer-col">Michaela Breyer<br>USt-Id Nr. DE30 627 68 78<br>Steuer-Nr.: 27/149/80446</div>
        </div>
    </div>

    <div class="a4-page">
        <img src="https://via.placeholder.com/200x120?text=LARAS+LOGO" class="header-logo">
        <div class="offer-header-small">
            Hier unser Angebot für den vorgenannten Event:<br>
            <strong>Angebot Nr. <span id="out-offer-id-2"></span></strong>
        </div>

        <table class="mindest-table">
            <thead>
                <tr>
                    <th class="col-pos">Bezeichnung</th>
                    <th class="col-qty">Portionen</th>
                    <th class="col-money">Einzelpreis brutto €</th>
                    <th class="col-money">Gesamtpreis brutto €</th>
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>

        <div class="document-footer">
            <div class="footer-col"><strong>Laras Kantinchen</strong><br>Chr.-Kröwerath-Str. 132<br>67071 Ludwigshafen</div>
            <div class="footer-col">Fon: 01 72 - 6 67 67 87<br>Fax: 06 21 - 65 05 57 96<br>laras-kantinchen@email.de</div>
            <div class="footer-col">Sparkasse Rhein-Haardt<br>IBAN: DE31 5465 1240 0006 1170 63</div>
            <div class="footer-col">Michaela Breyer<br>USt-Id Nr. DE30 627 68 78<br>Steuer-Nr.: 27/149/80446</div>
        </div>
    </div>
</div>

<script>
    function init() {
        const p = new URLSearchParams(window.location.search);
        if(p.get('recipient')) {
            document.getElementById('out-recipient').innerHTML = decodeURIComponent(escape(atob(p.get('recipient')))).replace(/\n/g, '<br>');
            document.getElementById('out-event').textContent = p.get('event');
            document.getElementById('out-location').textContent = p.get('location');
            document.getElementById('out-time').textContent = p.get('time');
            document.getElementById('out-offer-id').textContent = p.get('offerId');
            document.getElementById('out-offer-id-2').textContent = p.get('offerId');
            document.getElementById('out-valid-until').textContent = formatDate(p.get('validUntil'));
            document.getElementById('out-date').textContent = "am " + formatDate(p.get('date'));
            document.getElementById('out-today').textContent = new Date().toLocaleDateString('de-DE', { day: 'numeric', month: 'long', year: 'numeric' });
        }
        render();
    }

    function formatDate(iso) { return iso ? iso.split('-').reverse().join('.') : ''; }

    function render() {
        const qty = parseInt(document.getElementById('inp-qty').value) || 0;
        const price = parseFloat(document.getElementById('inp-price').value) || 0;
        const base = parseFloat(document.getElementById('inp-service-base').value) || 0;
        const extra = parseFloat(document.getElementById('inp-service-extra').value) || 0;
        
        document.getElementById('out-intro').textContent = document.getElementById('inp-intro').value;

        const html = `
            <tr>
                <td><strong>Servicegebühr inkl. Auf- und Abbau und 3 Stunden Verköstigungszeit mit 1 Oldtimer Truck, 2 Personal, Vorbereitung, Bioverpackungen, Servietten, Fahrtkosten und Reinigung</strong></td>
                <td align="center">1</td>
                <td align="right">${base.toFixed(2)}</td>
                <td align="right">${base.toFixed(2)}</td>
            </tr>
            <tr>
                <td><strong>Servicegebühr für jede weitere Stunde / Personal</strong></td>
                <td></td>
                <td align="right">${extra.toFixed(2)}</td>
                <td></td>
            </tr>
            <tr><td colspan="4" style="border:none; height:10px;"></td></tr>
            <tr>
                <td><div class="product-title">Pastrami Sandwich Sally</div><div class="product-desc">Gegrillte Pastrami zwischen 2 gerösteten Roggenmischbrot mit mildem Senf, Gurken, Salat, Röstzwiebeln, Cocktailsoße und Cheddar</div></td>
                <td></td><td></td><td></td>
            </tr>
            <tr>
                <td><div class="product-title">Pastrami Bowl</div><div class="product-desc">Gegrillte Pastrami auf Salat mit mildem Senf, Gurken-Schnitzen, Cocktailsoße, Röstzwiebeln, Cheddar, Spiegelei und Brotecken</div></td>
                <td></td><td></td><td></td>
            </tr>
            <tr>
                <td><div class="product-title">Käsespätzle mit Original Bergkäse-Mischung</div><div class="product-desc">mit Röstzwiebeln, frischen Kräutern an Salatbouquet</div></td>
                <td></td><td></td><td></td>
            </tr>
            <tr>
                <td><div class="product-title">Bunter Pflücksalat - vegetarisch -</div><div class="product-desc">mit frischer Wassermelone unter Hirtenkäse-Streusel an Kräutervinaigrette dazu geröstete Brotecken</div></td>
                <td></td><td></td><td></td>
            </tr>
            <tr>
                <td><div class="product-title"><span class="vegan">VEGAN</span></div><div class="product-desc"><strong>Veganes Linsen-Curry</strong> (pikant) mit frischem Koriander, gerösteten Cashew-Kernen und Limette an Basmatireis</div></td>
                <td></td><td></td><td></td>
            </tr>
            <tr><td colspan="4" style="border:none; height:10px;"></td></tr>
            <tr style="font-weight:bold; background:#fdfaf9;">
                <td>Mindestabnahme-Menge **</td>
                <td align="center">${qty}</td>
                <td align="right">${price.toFixed(2)}</td>
                <td align="right">${(qty * price).toFixed(2)}</td>
            </tr>
            <tr><td colspan="4" style="border:none; height:10px;"></td></tr>
            <tr style="font-weight:bold; font-size:10pt;">
                <td colspan="3">Summe aller Positionen</td>
                <td align="right">${(base + (qty * price)).toFixed(2)} €</td>
            </tr>
            <tr>
                <td colspan="4" style="border:none; font-size:7.5pt; color:#666; padding-top:10px;">Preise incl. der gesetzl. Umsatzsteuer</td>
            </tr>
        `;
        document.getElementById('table-body').innerHTML = html;
    }

    init();
</script>
</body>
</html>
